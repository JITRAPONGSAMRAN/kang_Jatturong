<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á ‡∏ô‡∏≤‡∏¢ Kang</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<style>
body {
    font-family: sans-serif;
    padding: 20px;
    max-width: 1200px;
    margin: auto;
}
table, th, td {
    border: 1px solid #ddd;
    border-collapse: collapse;
}
th, td {
    padding: 8px;
    text-align: center;
}
input[type="number"] {
    width: 70px;
}
button, select {
    margin: 10px 5px;
    padding: 5px 10px;
}
tr:nth-child(even) {background: #f2f2f2;}
tr.double-rate { background-color: #ffe0e0; }
tr.absent { background-color: #ddd; }
</style>
</head>
<body>
<h1>‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á ‡∏ô‡∏≤‡∏¢ Kang</h1>
<p>‡∏ê‡∏≤‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô 600 ‡∏ö‡∏≤‡∏ó/‡∏ß‡∏±‡∏ô (8 ‡∏ä‡∏°.), OT 1.5 ‡πÄ‡∏ó‡πà‡∏≤, ‡∏ï‡∏¥‡πä‡∏Å "2 ‡πÄ‡∏ó‡πà‡∏≤" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏¥‡∏î‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏õ‡∏Å‡∏ï‡∏¥‡πÅ‡∏•‡∏∞ OT ‡∏Ñ‡∏π‡∏ì 2</p>

<label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: <input type="month" id="monthSelect"></label>
<label>
    ‡∏á‡∏ß‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:
    <select id="periodSelect">
        <option value="first">1 - 15 ‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 20</option>
        <option value="second">16 - ‡∏™‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 5 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</option>
    </select>
</label>

<table>
<thead>
<tr><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏õ‡∏Å‡∏ï‡∏¥</th><th>OT (‡∏ä‡∏°.)</th><th>2 ‡πÄ‡∏ó‡πà‡∏≤</th><th>‡∏´‡∏¢‡∏∏‡∏î</th></tr>
</thead>
<tbody id="workTable"></tbody>
</table>

<button id="calcBtn">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</button>
<button id="clearBtn">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏ß‡∏î‡∏ô‡∏µ‡πâ</button>
<div id="result" style="margin-top:20px;"></div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const dailyWage = 600;
    const hoursPerDay = 8;
    const hourlyWage = dailyWage / hoursPerDay;
    const otRate = 1.5;
    const sundayRate = 2;

    const table = document.getElementById("workTable");
    const monthSelect = document.getElementById("monthSelect");
    const periodSelect = document.getElementById("periodSelect");
    const calcBtn = document.getElementById("calcBtn");
    const result = document.getElementById("result");

    function saveData() {
        const data = [];
        for (let row of table.rows) {
            data.push({
                date: row.cells[0].innerText,
                normalHours: row.cells[1].querySelector("input").value,
                otHours: row.cells[2].querySelector("input").value,
                isDouble: row.cells[3].querySelector("input").checked,
                isAbsent: row.cells[4].querySelector("input").checked
            });
        }
        const key = `${monthSelect.value}-${periodSelect.value}`;
        localStorage.setItem(key, JSON.stringify(data));
    }

    function loadData() {
        const key = `${monthSelect.value}-${periodSelect.value}`;
        const saved = localStorage.getItem(key);
        if (saved) {
            const data = JSON.parse(saved);
            data.forEach((d, i) => {
                if (table.rows[i]) {
                    table.rows[i].cells[1].querySelector("input").value = d.normalHours;
                    table.rows[i].cells[2].querySelector("input").value = d.otHours;
                    table.rows[i].cells[3].querySelector("input").checked = d.isDouble;
                    table.rows[i].cells[4].querySelector("input").checked = d.isAbsent;
                }
            });
        }
    }

    function generateTable(startDay, endDay, month, year) {
        table.innerHTML = "";
        for (let day = startDay; day <= endDay; day++) {
            const dateStr = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            const date = new Date(dateStr);
            if (isNaN(date)) continue;
            const dayName = date.toLocaleDateString("en-TH", { weekday: "short" });

            const row = document.createElement("tr");
            row.innerHTML = `
                <td style="color: ${dayName === "Sun" ? "red" : "black"}">${dateStr} (${dayName})</td>
                <td><input type="number" min="0" max="8" value="8"></td>
                <td><input type="number" min="0" value="2"></td>
                <td><input type="checkbox"></td>
                <td><input type="checkbox"></td>
            `;
            table.appendChild(row);
        }
    }

    function updateTable() {
        const [year, month] = monthSelect.value.split("-").map(Number);
        if (periodSelect.value === "second") {
            generateTable(16, new Date(year, month, 0).getDate(), month, year);
        } else {
            generateTable(1, 15, month, year);
        }
        loadData();
    }

    calcBtn.onclick = () => {
        let totalNormal = 0, totalOT1_5 = 0, totalOT2 = 0;
        let workDays = 0, doubleDays = 0, absentDays = 0;

        for (let row of table.rows) {
            const normalHours = parseFloat(row.cells[1].querySelector("input").value) || 0;
            const otHours = parseFloat(row.cells[2].querySelector("input").value) || 0;
            const isDoubleRate = row.cells[3].querySelector("input").checked;
            const isAbsent = row.cells[4].querySelector("input").checked;

            let normalRate = isDoubleRate ? sundayRate : 1;
            const wageNormal = isAbsent ? 0 : (normalHours / hoursPerDay) * dailyWage * normalRate;
            const wageOT = isAbsent ? 0 : otHours * hourlyWage * (isDoubleRate ? sundayRate : otRate);

            if (!isAbsent) workDays++;
            if (isDoubleRate) doubleDays++;
            if (isAbsent) absentDays++;

            totalNormal += wageNormal;
            if (isDoubleRate) {
                totalOT2 += otHours * hourlyWage * sundayRate;
            } else {
                totalOT1_5 += otHours * hourlyWage * otRate;
            }

            row.className = isAbsent ? "absent" : isDoubleRate ? "double-rate" : "";
        }

        const [year, month] = monthSelect.value.split("-").map(Number);
        let payDate, sso = 0;
        if (periodSelect.value === "second") {
            payDate = `5/${month + 1}/${year}`;
        } else {
            payDate = `20/${month}/${year}`;
            sso = 750;
        }

        const total = totalNormal + totalOT1_5 + totalOT2;
        const netPay = total - sso;

        result.innerHTML = `
            <div id="paySlip">
                <h3>‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‡∏ô‡∏≤‡∏¢ Kang (‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${payDate})</h3>
                <p>‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏õ‡∏Å‡∏ï‡∏¥‡∏£‡∏ß‡∏°: ${totalNormal.toFixed(2)} ‡∏ö‡∏≤‡∏ó</p>
                <p>‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á OT 1.5 ‡πÄ‡∏ó‡πà‡∏≤: ${totalOT1_5.toFixed(2)} ‡∏ö‡∏≤‡∏ó</p>
                <p>‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á OT 2 ‡πÄ‡∏ó‡πà‡∏≤: ${totalOT2.toFixed(2)} ‡∏ö‡∏≤‡∏ó</p>
                <p>‡∏´‡∏±‡∏Å‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏±‡∏á‡∏Ñ‡∏°: ${sso.toFixed(2)} ‡∏ö‡∏≤‡∏ó</p>
                <p><strong>‡∏£‡∏±‡∏ö‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ${netPay.toFixed(2)} ‡∏ö‡∏≤‡∏ó</strong></p>
                <hr>
                <p>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô: ${workDays} ‡∏ß‡∏±‡∏ô</p>
                <p>‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏á‡∏≤‡∏ô: ${absentDays} ‡∏ß‡∏±‡∏ô</p>
                <p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ 2 ‡πÄ‡∏ó‡πà‡∏≤: ${doubleDays} ‡∏ß‡∏±‡∏ô</p>
            </div>
            <button onclick="downloadPDF()">üìÑ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å PDF</button>
        `;

        saveData();
    };

    document.getElementById("clearBtn").onclick = () => {
        if (confirm("‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏ß‡∏î‡∏ô‡∏µ‡πâ?")) {
            const key = `${monthSelect.value}-${periodSelect.value}`;
            localStorage.removeItem(key);
            updateTable();
            result.innerHTML = "";
        }
    };

    window.downloadPDF = function () {
        const element = document.getElementById("paySlip");
        html2pdf().from(element).save(`Payslip_Kang.pdf`);
    };

    const today = new Date();
    const defaultMonth = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}`;
    monthSelect.value = defaultMonth;
    updateTable();
});
</script>
</body>
</html>
